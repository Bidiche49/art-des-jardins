# BUG-014: Reconciliation temp ID manquante pour 4 entites

**Type:** Bug
**Statut:** A faire
**Priorite:** Critique
**Complexite:** M
**Tags:** mobile, offline, sync, data
**Date creation:** 2026-02-26

---

## Description

Seuls les devis ont une reconciliation temp ID → real ID apres sync (via `DevisReconciliation`). Les 4 autres entites (clients, chantiers, interventions, factures) n'en ont pas. Consequence : apres creation offline et sync reussie, l'ancien record `temp-{timestamp}` reste en base locale a cote du vrai record serveur, creant des doublons et des IDs orphelins permanents.

## Cause racine

Dans `sync_providers.dart` (lignes 30-35), seul `devis` est enregistre :

```dart
service.registerReconciliation('devis', devisReconciliation.reconcile);
// Rien pour client, chantier, intervention, facture
```

## Fichiers concernes

### A creer
- `apps/mobile/lib/services/sync/client_reconciliation.dart`
- `apps/mobile/lib/services/sync/chantier_reconciliation.dart`
- `apps/mobile/lib/services/sync/intervention_reconciliation.dart`
- `apps/mobile/lib/services/sync/facture_reconciliation.dart`

### A modifier
- `apps/mobile/lib/services/sync/sync_providers.dart` — Enregistrer les 4 reconciliations

## Approche

Suivre le pattern de `DevisReconciliation` pour chaque entite :
1. Supprimer le record local avec le temp ID
2. Inserer le record avec le real ID (depuis la reponse API)
3. Mettre a jour les entites liees (ex: chantiers lies a un client, interventions liees a un chantier)
4. Pour les factures : migrer aussi les lignes de facture (quand la table existera, cf BUG-017)

## Criteres d'acceptation

- [ ] Chaque entite a sa classe de reconciliation
- [ ] Les 4 reconciliations sont enregistrees dans `syncServiceProvider`
- [ ] Apres sync d'un client offline : temp ID supprime, real ID insere, pas de doublon
- [ ] Apres sync d'un chantier offline : idem + chantiers lies au client correctement references
- [ ] Apres sync d'une intervention offline : idem
- [ ] Apres sync d'une facture offline : idem + lignes migrees

## Tests de validation

- [ ] Test unitaire par entite : reconciliation create (temp → real, pas de doublon)
- [ ] Test unitaire : reconciliation update (donnees mises a jour)
- [ ] Test unitaire : reconciliation avec entites liees (ex: chantier lie a un client temp)
- [ ] Test integration : creation offline → sync → reconciliation → UI affiche le real ID
