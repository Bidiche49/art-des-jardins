# IMP-016: Chiffrer les backups BDD

**Type:** Improvement
**Statut:** A faire
**Priorite:** Haute
**Complexite:** XS
**Tags:** security, infra, data
**Date creation:** 2026-02-12

---

## Description

Le script `docker/postgres/backup.sh` stocke les backups BDD en clair (`pg_dump | gzip`). Les donnees sensibles (clients, devis, factures, SIRET) ne sont pas protegees. Violation potentielle RGPD en cas d'acces non autorise aux backups.

## Criteres d'acceptation

- [ ] Backup chiffre avec AES-256-CBC
- [ ] Cle de chiffrement via variable d'environnement `BACKUP_ENCRYPTION_KEY`
- [ ] Script de restauration avec dechiffrement
- [ ] Variable documentee dans `.env.example`
- [ ] Test backup + restore fonctionnel

## Fichiers concernes

- `docker/postgres/backup.sh` - ajouter chiffrement
- `.env.example` - documenter BACKUP_ENCRYPTION_KEY

## Analyse / Approche

```bash
# Backup chiffre
pg_dump -U ${POSTGRES_USER} ${POSTGRES_DB} | \
  gzip | \
  openssl enc -aes-256-cbc -salt -pbkdf2 -k "${BACKUP_ENCRYPTION_KEY}" \
  > ${BACKUP_FILE}.enc

# Restore
openssl enc -aes-256-cbc -d -salt -pbkdf2 -k "${BACKUP_ENCRYPTION_KEY}" \
  -in ${BACKUP_FILE}.enc | \
  gunzip | \
  psql -U ${POSTGRES_USER} ${POSTGRES_DB}
```

## Tests de validation

- [ ] Backup genere un fichier .enc (pas lisible en clair)
- [ ] Restore depuis le fichier chiffre â†’ donnees intactes
- [ ] Sans la cle, impossible de lire le backup
