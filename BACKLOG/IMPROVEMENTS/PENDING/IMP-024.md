# IMP-024: Implementer ou retirer endpoints mockes (stats, categories)

**Type:** Improvement
**Statut:** A faire
**Priorite:** Moyenne
**Complexite:** S
**Tags:** api
**Date creation:** 2026-02-12

---

## Description

Deux endpoints retournent des donnees hardcodees/mockees :
- `GET /stats/dashboard` retourne des 0 et tableaux vides
- `GET /templates/categories` retourne un tableau hardcode avec un TODO

Ces endpoints sont inutiles en l'etat et peuvent induire en erreur.

## Criteres d'acceptation

- [ ] `/stats/dashboard` connecte a la BDD (vrais calculs) OU retire
- [ ] `/templates/categories` connecte a la BDD (SELECT DISTINCT) OU retire
- [ ] Pas de TODO restant dans le code de production

## Fichiers concernes

- `apps/api/src/modules/stats/stats.controller.ts:8-29` - donnees mockees
- `apps/api/src/modules/templates/templates.controller.ts:40-45` - TODO

## Analyse / Approche

### Stats - Implementer
```typescript
@Get('dashboard')
async getDashboard() {
  const [clients, devis, factures, interventions] = await Promise.all([
    this.prisma.client.count(),
    this.prisma.devis.count(),
    this.prisma.facture.count(),
    this.prisma.intervention.count({ where: { statut: 'en_cours' } }),
  ]);
  return { clients, devis, factures, interventionsEnCours: interventions };
}
```

### Templates categories - Implementer
```typescript
@Get('categories')
async getCategories() {
  const categories = await this.prisma.prestationTemplate.findMany({
    select: { categorie: true },
    distinct: ['categorie'],
  });
  return categories.map(c => c.categorie);
}
```

## Tests de validation

- [ ] GET /stats/dashboard retourne des vrais chiffres
- [ ] GET /templates/categories retourne les categories depuis la BDD
- [ ] Pas de TODO dans le code de production
