# IMP-011: Remplacer les types `any` par des interfaces typees

**Type:** Improvement
**Statut:** A faire
**Priorite:** Haute
**Complexite:** M
**Tags:** api, pwa, security
**Date creation:** 2026-02-12

---

## Description

Usage extensif du type `any` dans les controllers API (15+ occurrences de `@Request() req: any`) et dans les composants PWA (Calendar, services). Perte de type safety, risques d'erreurs runtime, autocomplete cassee.

## Criteres d'acceptation

- [ ] Interface `AuthenticatedRequest` creee et utilisee dans tous les controllers API
- [ ] `any` remplace par les bons types dans Calendar.tsx (Intervention au lieu de any)
- [ ] `any` remplace dans trash.service.ts et storage.service.ts
- [ ] `as any` supprime de devis.controller.ts:144
- [ ] 0 occurrence de `any` non justifiee dans le code source

## Fichiers concernes

### API
- `apps/api/src/modules/interventions/interventions.controller.ts:41,56,67,76`
- `apps/api/src/modules/calendar/calendar.controller.ts:46,56,66,77`
- `apps/api/src/modules/notifications/notifications.controller.ts:42,51,60,87`
- `apps/api/src/modules/absences/absences.controller.ts:49,77,91,120`
- `apps/api/src/modules/photos/photos.controller.ts:78,116`
- `apps/api/src/modules/templates/templates.controller.ts:66`
- `apps/api/src/modules/trash/trash.service.ts:40,60,77,204,290,295`
- `apps/api/src/modules/storage/storage.service.ts:155`
- `apps/api/src/modules/devis/devis.controller.ts:144`

### PWA
- `apps/pwa/src/pages/Calendar.tsx:37,141,149,170`
- `apps/pwa/src/components/calendar/CalendarEvent.tsx:11`

## Analyse / Approche

### API - Creer l'interface commune
```typescript
// apps/api/src/common/interfaces/request.interface.ts
import { Request } from 'express';

export interface AuthenticatedRequest extends Request {
  user: {
    sub: string;
    id: string;
    email: string;
    role: string;
    nom: string;
    prenom: string;
  };
}
```

### PWA - Typer Calendar
```typescript
import type { Intervention } from '@art-et-jardin/shared';

interface CalendarEventData {
  resource: {
    intervention?: Intervention;
    absence?: Absence;
    color: string;
    type: 'intervention' | 'absence';
  };
}
```

## Tests de validation

- [ ] `grep -rn ": any" apps/api/src/ --include="*.ts" | grep -v node_modules | grep -v test` â†’ verifier chaque restant est justifie
- [ ] Build API et PWA OK sans erreurs TypeScript
- [ ] Tests existants passent
