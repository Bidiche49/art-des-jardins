# IMP-051: Configurer SMTP Brevo pour envoi emails production

**Type:** Improvement
**Statut:** A faire
**Priorite:** Critique
**Complexite:** S
**Tags:** infra, api, mail
**Date creation:** 2026-02-24

---

## Description
Le service mail NestJS (`mail.service.ts`) est fonctionnel avec Nodemailer. En dev, les emails sont logues en console. Pour la production, il faut configurer un compte SMTP Brevo (ex-Sendinblue) et verifier que les emails arrivent correctement (contact form, devis, factures, relances).

## User Story
**En tant que** patron
**Je veux** recevoir les emails de contact et envoyer devis/factures par email
**Afin de** traiter les demandes clients et envoyer les documents

## Criteres d'acceptation
- [ ] Compte Brevo cree (plan gratuit 300 emails/jour suffit)
- [ ] Domaine expediteur verifie (SPF + DKIM sur artdesjardins.fr)
- [ ] Variables `.env.production` renseignees :
  - `SMTP_HOST=smtp-relay.brevo.com`
  - `SMTP_PORT=587`
  - `SMTP_USER=<cle API Brevo>`
  - `SMTP_PASSWORD=<mot de passe SMTP Brevo>`
  - `SMTP_FROM="Art des Jardins <contact@artdesjardins.fr>"`
  - `COMPANY_BCC_EMAIL=artdesjardins49@gmail.com`
  - `CONTACT_RECIPIENT_EMAIL=artdesjardins49@gmail.com`
- [ ] Email de test envoye et recu (pas en spam)
- [ ] DNS records SPF/DKIM configures sur le domaine

## Fichiers concernes
- `.env.production` — credentials SMTP
- `apps/api/src/modules/mail/mail.service.ts` — deja fonctionnel, rien a modifier
- DNS zone artdesjardins.fr — SPF + DKIM records

## Analyse / Approche
1. Creer compte Brevo → generer cle API SMTP
2. Ajouter records DNS :
   - SPF : `v=spf1 include:sendinblue.com ~all`
   - DKIM : record TXT fourni par Brevo
3. Renseigner les variables dans `.env.production`
4. Tester avec un curl sur `POST /api/v1/contact` en prod
5. Verifier la deliverabilite (inbox, pas spam)

## Tests de validation
- [ ] `POST /api/v1/contact` envoie un email recu dans la boite artdesjardins49@gmail.com
- [ ] Email non en spam (SPF/DKIM pass)
- [ ] BCC fonctionne (copie automatique)
- [ ] Template HTML lisible dans Gmail/Outlook
- [ ] Rate limit 5/min fonctionne sur l'endpoint
