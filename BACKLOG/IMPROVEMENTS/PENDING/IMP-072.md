# IMP-072: Navigation bottom tabs personnalisable par utilisateur

**Type:** Improvement
**Statut:** A faire
**Priorite:** Haute
**Complexite:** M
**Tags:** ux, navigation, mobile, settings
**Date creation:** 2026-02-25

---

## Description

Actuellement la bottom nav affiche 3 onglets fixes + "Plus" selon le role (patron/employe). Les 2 associes sont patron ET terrain : ils ont besoin tantot du Dashboard, tantot des Interventions, tantot du Calendrier en acces direct. Le split rigide par role ne correspond pas a leur usage reel.

L'utilisateur doit pouvoir choisir ses 3 onglets favoris depuis les Parametres. Le 4e onglet reste toujours "Plus" (non deplacable).

## User Story

**En tant que** patron-terrain (ou futur employe)
**Je veux** choisir quels 3 ecrans apparaissent dans ma barre de navigation
**Afin de** avoir un acces direct aux pages que j'utilise le plus au quotidien

## Contexte metier

- 2 associes patron+terrain, pas d'employes pour l'instant
- Usage mixte : Devis le matin, Interventions l'apres-midi, Dashboard le soir
- Quand des employes arriveront, chacun aura ses propres preferences

## Comportement attendu

### Ecran de configuration (dans Parametres)

- Section "Navigation" ou "Barre de navigation"
- Afficher la liste de TOUS les onglets disponibles avec leur icone
- L'utilisateur selectionne exactement 3 onglets parmi la liste
- Preview en bas de l'ecran montrant a quoi ressemblera la barre
- Bouton "Reinitialiser" pour revenir aux defaults du role
- Les changements s'appliquent immediatement (pas besoin de redemarrer)

### Onglets disponibles (pool complet)

| Onglet | Icone | Route | Dispo patron | Dispo employe |
|--------|-------|-------|:---:|:---:|
| Dashboard | dashboard | / | oui | non |
| Clients | people | /clients | oui | non |
| Chantiers | construction | /chantiers | oui | oui |
| Devis | description | /devis | oui | non |
| Calendrier | calendar_month | /calendar | oui | oui |
| Interventions | build | /interventions | oui | oui |
| Factures | receipt_long | /factures | oui | non |
| Analytics | bar_chart | /analytics | oui | non |

### Defaults par role (fallback si rien configure)

- **Patron** : Calendrier, Clients, Chantiers
- **Employe** : Interventions, Calendrier, Chantiers

### Persistance

- Stocker dans SharedPreferences (cle: `nav_tabs_config`)
- Format: liste ordonnee de 3 route paths
- Exemple: `["/calendar", "/clients", "/chantiers"]`
- Lu au demarrage dans AppShell, pas de fetch reseau

### Page "Plus" dynamique

- La page "Plus" doit exclure les onglets deja visibles dans la barre
- Exemple : si le patron a mis Devis dans ses tabs, Devis disparait du menu "Plus"

## Criteres d'acceptation

- [ ] Section "Barre de navigation" dans la page Parametres
- [ ] Affichage de tous les onglets disponibles pour le role
- [ ] Selection de exactement 3 onglets (pas plus, pas moins)
- [ ] Preview visuelle de la barre en bas de l'ecran de config
- [ ] Bouton reinitialiser vers defaults du role
- [ ] Persistance locale SharedPreferences
- [ ] AppShell lit la config et affiche les bons onglets
- [ ] Page "Plus" exclut dynamiquement les onglets visibles
- [ ] Changement applique immediatement sans redemarrage
- [ ] Tests unitaires pour la logique de config
- [ ] Tests widget pour l'ecran de configuration
- [ ] Tests widget pour AppShell avec config custom

## Fichiers concernes

- `apps/mobile/lib/shared/layouts/app_shell.dart` — lire config au lieu des listes hardcodees
- `apps/mobile/lib/features/settings/presentation/pages/settings_page.dart` — ajouter entree navigation
- `apps/mobile/lib/features/settings/presentation/pages/nav_config_page.dart` — NOUVEAU
- `apps/mobile/lib/features/settings/presentation/providers/nav_config_provider.dart` — NOUVEAU
- `apps/mobile/lib/features/more/presentation/pages/more_page.dart` — filtrer items dynamiquement

## Approche technique

1. Creer un `NavConfigNotifier` (Riverpod) qui charge/sauvegarde depuis SharedPreferences
2. Provider expose `List<String>` (3 route paths) + methodes `update()`, `reset()`
3. `AppShell.build()` : `ref.watch(navConfigProvider)` au lieu des listes const
4. `MorePage` : filtrer les items dont le path est deja dans la nav config
5. Ecran config : ReorderableListView ou selection par tap avec compteur (3 max)

## UX Details

- Animation smooth quand on selectionne/deselectionne un onglet
- Haptic feedback au tap
- Si l'utilisateur est sur une page qui devient un tab direct, la nav doit se mettre a jour sans perdre la page courante
- Message d'aide : "Choisissez 3 ecrans pour votre barre de navigation"
