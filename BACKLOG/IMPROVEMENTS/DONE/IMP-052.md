# IMP-052: Configurer Scaleway Object Storage (S3) pour production

**Type:** Improvement
**Statut:** Fait
**Priorite:** Haute
**Complexite:** S
**Tags:** infra, storage, photos
**Date creation:** 2026-02-24

---

## Description
Le service storage NestJS (`storage.service.ts`) utilise AWS SDK v3 compatible S3. Il faut creer un bucket Scaleway Object Storage pour stocker les photos de contact, les PDFs archives et les backups BDD. Le service degrade gracieusement si S3 n'est pas configure (les photos ne sont simplement pas stockees).

## User Story
**En tant que** patron
**Je veux** que les photos clients et documents soient stockes de maniere durable
**Afin de** ne perdre aucun document et pouvoir les retrouver

## Criteres d'acceptation
- [ ] Bucket Scaleway cree (`art-et-jardin-prod`, region `fr-par`)
- [ ] IAM key avec permissions lecture/ecriture sur le bucket uniquement
- [ ] Variables `.env.production` renseignees :
  - `S3_ENDPOINT=https://s3.fr-par.scw.cloud`
  - `S3_ACCESS_KEY=<Scaleway access key>`
  - `S3_SECRET_KEY=<Scaleway secret key>`
  - `S3_BUCKET=art-et-jardin-prod`
  - `S3_REGION=fr-par`
- [ ] CORS configure sur le bucket (pour upload direct si necessaire)
- [ ] Politique de lifecycle : archivage Glacier apres 90 jours (optionnel)
- [ ] Test upload/download fonctionne

## Fichiers concernes
- `.env.production` — credentials S3
- `apps/api/src/modules/storage/storage.service.ts` — deja fonctionnel, rien a modifier
- Console Scaleway — creation bucket + IAM

## Analyse / Approche
1. Creer projet Scaleway (si pas deja fait)
2. Object Storage → Creer bucket `art-et-jardin-prod` en `fr-par`
3. IAM → Creer API key dediee avec scope bucket
4. Configurer CORS si besoin (origins: artdesjardins.fr)
5. Renseigner les variables dans `.env.production`
6. Tester avec upload photo via formulaire contact

## Cout estime
- Scaleway Object Storage : ~0.01€/Go/mois (75 Go gratuits)
- Largement dans le budget 15-30€/mois

## Tests de validation
- [ ] Upload photo via `POST /api/v1/contact` → fichier present dans le bucket
- [ ] Backup BDD stocke dans S3 (quand FEAT-108 sera fait)
- [ ] PDF archive accessible via signed URL
- [ ] storage.service.isConfigured() retourne true
- [ ] storage.service.checkConnection() reussit
