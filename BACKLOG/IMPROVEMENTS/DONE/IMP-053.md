# IMP-053: Creer .env.production securise et checklist deploiement

**Type:** Improvement
**Statut:** Fait
**Priorite:** Critique
**Complexite:** S
**Tags:** infra, security, deploy
**Date creation:** 2026-02-24

---

## Description
Creer le fichier `.env.production` definitif avec toutes les 39+ variables d'environnement necessaires, generer les secrets cryptographiques, et documenter la checklist de deploiement. Ce fichier ne doit JAMAIS etre commite dans git (cf. BUG-004).

## User Story
**En tant que** ops
**Je veux** un template complet de configuration production
**Afin de** deployer sans oublier de variable et sans faille de securite

## Criteres d'acceptation
- [ ] `.env.production.example` mis a jour avec TOUTES les variables (39+)
- [ ] `.env.production` dans `.gitignore` (deja le cas, verifier)
- [ ] Secrets generes avec `openssl rand` :
  - JWT_SECRET (64 chars min)
  - BACKUP_ENCRYPTION_KEY (32 chars min)
  - TWO_FACTOR_ENCRYPTION_KEY (32 chars min)
- [ ] Document `docs/DEPLOY_CHECKLIST.md` cree avec etapes pas-a-pas
- [ ] Toutes les variables groupees par categorie avec commentaires

## Fichiers concernes
- `.env.production.example` — mettre a jour
- `.gitignore` — verifier .env.production present
- `docs/DEPLOY_CHECKLIST.md` — creer

## Variables a documenter (groupees)

### Base de donnees
```
DATABASE_URL=postgresql://user:pass@postgres:5432/artjardin
```

### API Server
```
NODE_ENV=production
API_PORT=3000
API_HOST=0.0.0.0
LOG_LEVEL=warn
```

### JWT Auth (GENERER AVEC openssl rand -base64 64)
```
JWT_SECRET=<64+ chars>
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d
```

### SMTP (Brevo — cf. IMP-051)
```
SMTP_HOST=smtp-relay.brevo.com
SMTP_PORT=587
SMTP_USER=<cle>
SMTP_PASSWORD=<secret>
SMTP_FROM="Art des Jardins <contact@artdesjardins.fr>"
COMPANY_BCC_EMAIL=artdesjardins49@gmail.com
CONTACT_RECIPIENT_EMAIL=artdesjardins49@gmail.com
```

### S3 Storage (Scaleway — cf. IMP-052)
```
S3_ENDPOINT=https://s3.fr-par.scw.cloud
S3_ACCESS_KEY=<key>
S3_SECRET_KEY=<secret>
S3_BUCKET=art-et-jardin-prod
S3_REGION=fr-par
```

### Security
```
CORS_ORIGINS=https://artdesjardins.fr,https://app.artdesjardins.fr
THROTTLE_TTL=60
THROTTLE_LIMIT=100
TWO_FACTOR_ENCRYPTION_KEY=<32+ chars>
BACKUP_ENCRYPTION_KEY=<32+ chars>
SOFT_DELETE_RETENTION_DAYS=90
```

### Features flags
```
RELANCE_ENABLED=true
BACKUP_ENABLED=true
ALERTS_ENABLED=true
```

## Tests de validation
- [ ] `.env.production` n'est PAS dans git (`git status` propre)
- [ ] L'API demarre avec toutes les variables (pas d'erreur Joi)
- [ ] Aucun secret en fallback/hardcode utilise en prod
- [ ] `docs/DEPLOY_CHECKLIST.md` lisible et actionnable
