# IMP-001: Helmet.js + Headers CSP

**Type:** Improvement
**Statut:** Fait
**Priorite:** Critique
**Complexite:** XS
**Tags:** security, api
**Date creation:** 2026-02-03
**Date completion:** 2026-02-03
**Phase:** 11

---

## Description

Ajouter Helmet.js au backend NestJS pour configurer automatiquement les headers de securite HTTP (CSP, X-Frame-Options, HSTS, etc.).

## Contexte

Les headers de securite HTTP sont une protection de base contre :
- XSS (Content-Security-Policy)
- Clickjacking (X-Frame-Options)
- MIME sniffing (X-Content-Type-Options)
- Downgrade attacks (Strict-Transport-Security)

Helmet.js est le standard pour Express/NestJS.

## Criteres d'acceptation

- [x] Helmet.js installe et configure dans main.ts
- [x] CSP configure pour bloquer inline scripts (sauf nonce)
- [x] HSTS active avec max-age 1 an
- [x] X-Frame-Options: DENY
- [x] X-Content-Type-Options: nosniff
- [x] Referrer-Policy: strict-origin-when-cross-origin
- [x] Tests de verification des headers

## Fichiers concernes

- `apps/api/src/main.ts`
- `apps/api/package.json`
- `apps/api/test/security-headers.e2e-spec.ts`

## Implementation

```typescript
// main.ts
import helmet from 'helmet';

app.use(
  helmet({
    contentSecurityPolicy: {
      directives: {
        defaultSrc: ["'self'"],
        scriptSrc: ["'self'"],
        styleSrc: ["'self'", "'unsafe-inline'"],
        imgSrc: ["'self'", 'data:', 'https:'],
        fontSrc: ["'self'", 'https:', 'data:'],
        connectSrc: ["'self'"],
        objectSrc: ["'none'"],
        frameSrc: ["'none'"],
        baseUri: ["'self'"],
        formAction: ["'self'"],
      },
    },
    hsts: {
      maxAge: 31536000, // 1 year
      includeSubDomains: true,
      preload: true,
    },
    frameguard: { action: 'deny' },
    noSniff: true,
    referrerPolicy: { policy: 'strict-origin-when-cross-origin' },
    xssFilter: true,
  })
);
```

## Tests de validation

- [x] Tests e2e pour verifier les headers securite
- [x] 442 tests unitaires passent
- [x] Verification CSP, X-Frame-Options, HSTS, nosniff, Referrer-Policy

## Notes d'implementation

Headers ajoutes par Helmet:
- Content-Security-Policy (CSP complet)
- X-Frame-Options: DENY
- X-Content-Type-Options: nosniff
- Strict-Transport-Security (1 an + preload)
- Referrer-Policy: strict-origin-when-cross-origin
- X-DNS-Prefetch-Control: off
- X-Download-Options: noopen
- X-Permitted-Cross-Domain-Policies: none
- X-Powered-By: supprime
